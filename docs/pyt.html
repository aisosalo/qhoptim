

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quasi-hyperbolic optimizers for PyTorch &mdash; qhoptim 1.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" defer="defer" type="text/javascript" src="https://buttons.github.io/buttons.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Quasi-hyperbolic optimizers for TensorFlow" href="tf.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> qhoptim
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quasi-hyperbolic optimizers for PyTorch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#qhm-api-reference">QHM API reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#qhadam-api-reference">QHAdam API reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tf.html">Quasi-hyperbolic optimizers for TensorFlow</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">qhoptim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quasi-hyperbolic optimizers for PyTorch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/pyt.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quasi-hyperbolic-optimizers-for-pytorch">
<h1>Quasi-hyperbolic optimizers for PyTorch<a class="headerlink" href="#quasi-hyperbolic-optimizers-for-pytorch" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>The PyTorch optimizer classes are <a class="reference internal" href="#qhoptim.pyt.QHM" title="qhoptim.pyt.QHM"><code class="xref py py-class docutils literal notranslate"><span class="pre">qhoptim.pyt.QHM</span></code></a> and
<a class="reference internal" href="#qhoptim.pyt.QHAdam" title="qhoptim.pyt.QHAdam"><code class="xref py py-class docutils literal notranslate"><span class="pre">qhoptim.pyt.QHAdam</span></code></a>.</p>
<p>Use these optimizers as you would any other PyTorch optimizer:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qhoptim.pyt</span> <span class="kn">import</span> <span class="n">QHM</span><span class="p">,</span> <span class="n">QHAdam</span>

<span class="go"># something like this for QHM</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">QHM</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>

<span class="go"># or something like this for QHAdam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">QHAdam</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">nus</span><span class="o">=</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">))</span>

<span class="go"># a single optimization step</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="qhm-api-reference">
<h2>QHM API reference<a class="headerlink" href="#qhm-api-reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="qhoptim.pyt.QHM">
<em class="property">class </em><code class="descclassname">qhoptim.pyt.</code><code class="descname">QHM</code><span class="sig-paren">(</span><em>params</em>, <em>lr=&lt;required parameter&gt;</em>, <em>momentum=&lt;required parameter&gt;</em>, <em>nu=&lt;required parameter&gt;</em>, <em>weight_decay=0.0</em>, <em>weight_decay_type='grad'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements the quasi-hyperbolic momentum (QHM) optimization algorithm
<a class="reference external" href="https://arxiv.org/abs/1810.06801">(Ma and Yarats, 2019)</a>.</p>
<p>Note that many other optimization algorithms are accessible via specific
parameterizations of QHM. See <a class="reference internal" href="#qhoptim.pyt.QHM.from_accsgd" title="qhoptim.pyt.QHM.from_accsgd"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_accsgd()</span></code></a>,
<a class="reference internal" href="#qhoptim.pyt.QHM.from_robust_momentum" title="qhoptim.pyt.QHM.from_robust_momentum"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_robust_momentum()</span></code></a>, etc. for details.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> (<em>iterable</em>) – iterable of parameters to optimize or dicts defining parameter
groups</li>
<li><strong>lr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – learning rate (<span class="math notranslate nohighlight">\(\alpha\)</span> from the paper)</li>
<li><strong>momentum</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – momentum factor (<span class="math notranslate nohighlight">\(\beta\)</span> from the paper)</li>
<li><strong>nu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – immediate discount factor (<span class="math notranslate nohighlight">\(\nu\)</span> from the paper)</li>
<li><strong>weight_decay</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – weight decay (L2 regularization coefficient, times two)
(default: 0.0)</li>
<li><strong>weight_decay_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – method of applying the weight decay:
<code class="docutils literal notranslate"><span class="pre">&quot;grad&quot;</span></code> for accumulation in the gradient
(same as <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.optim.SGD</span></code>) or
<code class="docutils literal notranslate"><span class="pre">&quot;direct&quot;</span></code> for direct application to the parameters
(default: <code class="docutils literal notranslate"><span class="pre">&quot;grad&quot;</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Mathematically, QHM is a simple interpolation between plain SGD and
momentum:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
    g_{t + 1} &amp;\leftarrow
        \beta \cdot g_t +
        (1 - \beta) \cdot \nabla_t \\
    \theta_{t + 1} &amp;\leftarrow
        \theta_t + \alpha \left[ (1 - \nu) \cdot \nabla_t +
                                 \nu \cdot g_{t + 1} \right]
\end{align*}\end{split}\]</div>
<p class="last">Here, <span class="math notranslate nohighlight">\(\alpha\)</span> is the learning rate, <span class="math notranslate nohighlight">\(\beta\)</span> is the momentum
factor, and <span class="math notranslate nohighlight">\(\nu\)</span> is the “immediate discount” factor which
controls the interpolation between plain SGD and momentum.
<span class="math notranslate nohighlight">\(g_t\)</span> is the momentum buffer, <span class="math notranslate nohighlight">\(\theta_t\)</span> is the parameter
vector, and <span class="math notranslate nohighlight">\(\nabla_t\)</span> is the gradient with respect to
<span class="math notranslate nohighlight">\(\theta_t\)</span>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">QHM uses <strong>dampened</strong> momentum. This means that when converting from
plain momentum to QHM, the learning rate must be scaled by
<span class="math notranslate nohighlight">\(\frac{1}{1 - \beta}\)</span>. For example, momentum with learning rate
<span class="math notranslate nohighlight">\(\alpha = 0.1\)</span> and momentum <span class="math notranslate nohighlight">\(\beta = 0.9\)</span> should be
converted to QHM with learning rate <span class="math notranslate nohighlight">\(\alpha = 1.0\)</span>.</p>
</div>
<dl class="classmethod">
<dt id="qhoptim.pyt.QHM.from_accsgd">
<em class="property">classmethod </em><code class="descname">from_accsgd</code><span class="sig-paren">(</span><em>delta</em>, <em>kappa</em>, <em>xi</em>, <em>eps=0.7</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.from_accsgd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.from_accsgd" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHM hyperparameters required to recover the AccSGD
optimizer <a class="reference external" href="https://arxiv.org/abs/1803.05591">(Kidambi et al., 2018)</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>delta</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – short step (see reference)</li>
<li><strong>kappa</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – long step parameter (see reference)</li>
<li><strong>xi</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – statistical advantage parameter (see reference)</li>
<li><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – arbitrary value, between 0 and 1 exclusive (see reference)
(default: 0.7)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">momentum</span></code>, and <code class="docutils literal notranslate"><span class="pre">nu</span></code>
to use in QHM.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="o">.</span><span class="n">from_accsgd</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="mf">10.0</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="qhoptim.pyt.QHM.from_pid">
<em class="property">classmethod </em><code class="descname">from_pid</code><span class="sig-paren">(</span><em>k_p</em>, <em>k_i</em>, <em>k_d</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.from_pid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.from_pid" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHM hyperparameters required to recover a PID
optimizer as described in <a class="reference external" href="https://web.archive.org/web/20181027184056/http://www.argmin.net/2018/04/19/pid/">Recht (2018)</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>k_p</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – proportional gain (see reference)</li>
<li><strong>k_i</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – integral gain (see reference)</li>
<li><strong>k_d</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – derivative gain (see reference)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">momentum</span></code>, and <code class="docutils literal notranslate"><span class="pre">nu</span></code>
to use in QHM.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="o">.</span><span class="n">from_pid</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">k_p</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">k_i</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">k_d</span><span class="o">=</span><span class="mf">3.0</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="qhoptim.pyt.QHM.from_robust_momentum">
<em class="property">classmethod </em><code class="descname">from_robust_momentum</code><span class="sig-paren">(</span><em>l</em>, <em>kappa</em>, <em>rho=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.from_robust_momentum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.from_robust_momentum" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHM hyperparameters required to recover the Robust
Momentum <a class="reference external" href="https://arxiv.org/abs/1710.04753">(Cyrus et al., 2018)</a> or Triple Momentum
<a class="reference external" href="http://www.optimization-online.org/DB_FILE/2017/03/5908.pdf">(Scoy et al., 2018)</a> optimizers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>l</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Lipschitz constant of gradient (see reference)</li>
<li><strong>kappa</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – condition ratio (see reference)</li>
<li><strong>rho</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – noise-free convergence rate. If None, will return the
parameters for the Triple Momentum optimizer.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">momentum</span></code>, and <code class="docutils literal notranslate"><span class="pre">nu</span></code>
to use in QHM.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="o">.</span><span class="n">from_robust_momentum</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">l</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mf">15.0</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="qhoptim.pyt.QHM.from_synthesized_nesterov">
<em class="property">classmethod </em><code class="descname">from_synthesized_nesterov</code><span class="sig-paren">(</span><em>alpha</em>, <em>beta1</em>, <em>beta2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.from_synthesized_nesterov"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.from_synthesized_nesterov" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHM hyperparameters required to recover the
synthesized Nesterov optimizer (Section 6 of <a class="reference external" href="https://arxiv.org/abs/1408.3595">Lessard et al. (2016)</a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – learning rate</li>
<li><strong>beta1</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – first momentum (see reference)</li>
<li><strong>beta2</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – second momentum (see reference)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">momentum</span></code>, and <code class="docutils literal notranslate"><span class="pre">nu</span></code>
to use in QHM.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="o">.</span><span class="n">from_synthesized_nesterov</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">beta1</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">beta2</span><span class="o">=</span><span class="mf">0.6</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="qhoptim.pyt.QHM.from_two_state_optimizer">
<em class="property">classmethod </em><code class="descname">from_two_state_optimizer</code><span class="sig-paren">(</span><em>h</em>, <em>k</em>, <em>l</em>, <em>m</em>, <em>q</em>, <em>z</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.from_two_state_optimizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.from_two_state_optimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHM hyperparameters required to recover the
following optimizer (named “TSO” in <a class="reference external" href="https://arxiv.org/abs/1810.06801">Ma and Yarats (2019)</a>):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
    a_{t + 1} &amp;\leftarrow
        h \cdot a_t + k \cdot \theta_t + l \cdot \nabla_t \\
    \theta_{t + 1} &amp;\leftarrow
        m \cdot a_t + q \cdot \theta_t + z \cdot \nabla_t
\end{align*}\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(a_t\)</span> and <span class="math notranslate nohighlight">\(\theta_t\)</span> are the two states and
<span class="math notranslate nohighlight">\(\nabla_t\)</span> is the gradient with respect to <span class="math notranslate nohighlight">\(\theta_t\)</span>.</p>
<p>Be careful that your coefficients satisfy the regularity conditions
from the reference.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>h</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
<li><strong>k</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
<li><strong>l</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
<li><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
<li><strong>q</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
<li><strong>z</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – see description</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">momentum</span></code>, and <code class="docutils literal notranslate"><span class="pre">nu</span></code>
to use in QHM.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHM</span><span class="o">.</span><span class="n">from_two_state_optimizer</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">h</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">m</span><span class="o">=-</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="qhoptim.pyt.QHM.step">
<code class="descname">step</code><span class="sig-paren">(</span><em>closure=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhm.html#QHM.step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHM.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a single optimization step.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>closure</strong> (<em>callable</em><em>, </em><em>optional</em>) – A closure that reevaluates the model and returns the loss.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="qhadam-api-reference">
<h2>QHAdam API reference<a class="headerlink" href="#qhadam-api-reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="qhoptim.pyt.QHAdam">
<em class="property">class </em><code class="descclassname">qhoptim.pyt.</code><code class="descname">QHAdam</code><span class="sig-paren">(</span><em>params</em>, <em>lr=0.001</em>, <em>betas=(0.9</em>, <em>0.999)</em>, <em>nus=(1.0</em>, <em>1.0)</em>, <em>weight_decay=0.0</em>, <em>decouple_weight_decay=False</em>, <em>eps=1e-08</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhadam.html#QHAdam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHAdam" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements the QHAdam optimization algorithm <a class="reference external" href="https://arxiv.org/abs/1810.06801">(Ma and Yarats, 2019)</a>.</p>
<p>Note that the NAdam optimizer is accessible via a specific parameterization
of QHAdam. See <a class="reference internal" href="#qhoptim.pyt.QHAdam.from_nadam" title="qhoptim.pyt.QHAdam.from_nadam"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_nadam()</span></code></a> for details.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> (<em>iterable</em>) – iterable of parameters to optimize or dicts defining parameter
groups</li>
<li><strong>lr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – learning rate (<span class="math notranslate nohighlight">\(\alpha\)</span> from the paper)
(default: 1e-3)</li>
<li><strong>betas</strong> (<em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em><em>, </em><em>optional</em>) – coefficients used for computing
running averages of the gradient and its square
(default: (0.9, 0.999))</li>
<li><strong>nus</strong> (<em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em><em>, </em><em>optional</em>) – immediate discount factors used to
estimate the gradient and its square
(default: (1.0, 1.0))</li>
<li><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – term added to the denominator to improve
numerical stability
(default: 1e-8)</li>
<li><strong>weight_decay</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – weight decay (default: 0.0)</li>
<li><strong>decouple_weight_decay</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a><em>, </em><em>optional</em>) – whether to decouple the weight
decay from the gradient-based optimization step
(default: False)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHAdam</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">lr</span><span class="o">=</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">nus</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="qhoptim.pyt.QHAdam.from_nadam">
<em class="property">classmethod </em><code class="descname">from_nadam</code><span class="sig-paren">(</span><em>lr=0.001</em>, <em>betas=(0.9</em>, <em>0.999)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhadam.html#QHAdam.from_nadam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHAdam.from_nadam" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the QHAdam hyperparameters required to recover the NAdam
optimizer <a class="reference external" href="https://openreview.net/pdf?id=OM0jvwB8jIp57ZJjtNEZ">(Dozat, 2016)</a>.</p>
<p>This is <em>not</em> an identical recovery of the formulation in the paper, due
to subtle differences in the application of the bias correction in the
first moment estimator. However, in practice, this difference is almost
certainly irrelevant.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – learning rate (<span class="math notranslate nohighlight">\(\alpha\)</span> from the paper)
(default: 1e-3)</li>
<li><strong>betas</strong> (<em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>]</em><em>, </em><em>optional</em>) – coefficients used for computing running averages of the
gradient and its square
(default: (0.9, 0.999))</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Three-element <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing <code class="docutils literal notranslate"><span class="pre">lr</span></code>, <code class="docutils literal notranslate"><span class="pre">betas</span></code>, and <code class="docutils literal notranslate"><span class="pre">nus</span></code>
to use in QHAdam.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHAdam</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="n">qhoptim</span><span class="o">.</span><span class="n">pyt</span><span class="o">.</span><span class="n">QHAdam</span><span class="o">.</span><span class="n">from_nadam</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">)))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="qhoptim.pyt.QHAdam.step">
<code class="descname">step</code><span class="sig-paren">(</span><em>closure=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhadam.html#QHAdam.step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHAdam.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a single optimization step.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>closure</strong> (<em>callable</em><em>, </em><em>optional</em>) – A closure that reevaluates the model and returns the loss.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="qhoptim.pyt.QHAdamW">
<code class="descclassname">qhoptim.pyt.</code><code class="descname">QHAdamW</code><span class="sig-paren">(</span><em>params</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/qhoptim/pyt/qhadam.html#QHAdamW"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#qhoptim.pyt.QHAdamW" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the decoupled decay variant of the QHAdam optimization
algorithm <a class="reference external" href="https://arxiv.org/abs/1810.06801">(Ma and Yarats, 2019)</a>,
as proposed by <a class="reference external" href="https://arxiv.org/abs/1711.05101">Loschilov and Hutter (2017)</a>.</p>
<p>Shares all arguments of the <a class="reference internal" href="#qhoptim.pyt.QHAdam" title="qhoptim.pyt.QHAdam"><code class="xref py py-class docutils literal notranslate"><span class="pre">QHAdam</span></code></a> constructor –
equivalent to constructing <a class="reference internal" href="#qhoptim.pyt.QHAdam" title="qhoptim.pyt.QHAdam"><code class="xref py py-class docutils literal notranslate"><span class="pre">QHAdam</span></code></a> with
<code class="docutils literal notranslate"><span class="pre">decouple_weight_decay=True</span></code>.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tf.html" class="btn btn-neutral float-right" title="Quasi-hyperbolic optimizers for TensorFlow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Facebook, Inc. and its affiliates.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>